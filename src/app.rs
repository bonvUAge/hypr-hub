// ü¶Ä –ú–æ–¥—É–ª—å —Å –ª–æ–≥–∏–∫–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (App state)
// –≠—Ç–æ –∫–∞–∫ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (state) –≤ React - —Ö—Ä–∞–Ω–∏–º –¥–∞–Ω–Ω—ã–µ –∏ –º–µ—Ç–æ–¥—ã –¥–ª—è –∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è

use ratatui::widgets::ListState;

// ü¶Ä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ App - —ç—Ç–æ "—Å–æ—Å—Ç–æ—è–Ω–∏–µ" –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
// –í Rust —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (struct) –ø–æ—Ö–æ–∂–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç—ã –≤ JavaScript,
// –Ω–æ —Å –æ–¥–Ω–∏–º –≤–∞–∂–Ω—ã–º –æ—Ç–ª–∏—á–∏–µ–º: —Ç–∏–ø—ã –ø–æ–ª–µ–π —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã!
pub struct App<'a> {
    // 'a - —ç—Ç–æ lifetime (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏)
    // –ì–æ–≤–æ—Ä–∏—Ç –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—É: "–≠–π, —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏ –±—É–¥—É—Ç –∂–∏—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–ª–≥–æ!"
    // –í JavaScript —Ç–∞–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –Ω–µ—Ç - —Ç–∞–º —Å–±–æ—Ä—â–∏–∫ –º—É—Å–æ—Ä–∞
    pub items: Vec<(&'a str, &'a str)>,
    pub state: ListState,
}

impl<'a> App<'a> {
    // ü¶Ä –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä - —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä App
    // –≠—Ç–æ –∫–∞–∫ constructor() –≤ –∫–ª–∞—Å—Å–∞—Ö JavaScript
    pub fn new() -> App<'a> {
        let mut state = ListState::default();
        // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (–∫–∞–∫ useState(0) –≤ React)
        state.select(Some(0));

        App {
            items: vec![
                ("üîÇ Update System", "./scripts/update.sh"),
                ("üßπ Clean Pacman&Paru Cache", "./scripts/scc.sh"),
                ("ü™† Clean RAM", "sudo sync; sudo sysctl -w vm.drop_caches=3"),
            ],
            state,
        }
    }

    // ü¶Ä –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –ø—É–Ω–∫—Ç—É –º–µ–Ω—é
    // &mut self - —ç—Ç–æ –∫–∞–∫ this –≤ JavaScript, –Ω–æ —è–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç,
    // —á—Ç–æ –º—ã –ò–ó–ú–ï–ù–Ø–ï–ú –æ–±—ä–µ–∫—Ç (–º—É—Ç–∏—Ä—É–µ–º –µ–≥–æ)
    pub fn next(&mut self) {
        let i = match self.state.selected() {
            Some(i) => {
                // –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥: –µ—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π —ç–ª–µ–º–µ–Ω—Ç - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø–µ—Ä–≤–æ–º—É
                if i >= self.items.len() - 1 {
                    0
                } else {
                    i + 1
                }
            }
            None => 0,
        };
        self.state.select(Some(i));
    }

    // ü¶Ä –ü–µ—Ä–µ—Ö–æ–¥ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –ø—É–Ω–∫—Ç—É –º–µ–Ω—é
    pub fn previous(&mut self) {
        let i = match self.state.selected() {
            Some(i) => {
                // –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –≤ –æ–±—Ä–∞—Ç–Ω—É—é —Å—Ç–æ—Ä–æ–Ω—É
                if i == 0 {
                    self.items.len() - 1
                } else {
                    i - 1
                }
            }
            None => 0,
        };
        self.state.select(Some(i));
    }

    // ü¶Ä –ü–æ–ª—É—á–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–æ–º–∞–Ω–¥—É
    // Option<T> - —ç—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–∫–∞–∑–∞—Ç—å "–º–æ–∂–µ—Ç –±—ã—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ, –∞ –º–æ–∂–µ—Ç –∏ –Ω–µ—Ç"
    // –í JavaScript —ç—Ç–æ –∫–∞–∫ value || null, –Ω–æ —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ!
    pub fn get_selected_command(&self) -> Option<&str> {
        self.state.selected().map(|i| self.items[i].1)
    }
}
